# CodePilot1C EDT — промпты заточены под production-разработку в 1С

Сборка: `0.1.7.20260218-1246`

Два больших изменения в одном релизе: полностью настраиваемая система промптов и новые дефолтные шаблоны, заточенные под архитектурную разработку в 1С. Агент теперь отвечает как senior 1С-архитектор, а не как generic code assistant.

---

## 1. Настраиваемые промпты и system prompt

### Пользовательские шаблоны команд

Все встроенные команды теперь работают через редактируемые шаблоны:

- Explain Code
- Generate Code
- Fix Code
- Criticise Code
- Add Code
- Generate Doc Comments
- Find Similar Code
- Optimize Query

Не нравится, как агент объясняет код или генерирует комментарии - меняете шаблон в настройках, и все последующие вызовы используют вашу версию. Каждый шаблон содержит обязательные плейсхолдеры (`{code}`, `{context}`), которые подсвечиваются в редакторе. Если случайно удалили нужный - плагин предупредит. Сброс к дефолту - одной кнопкой.

### Кастомизация system prompt

В настройках появились поля для префикса и суффикса system prompt. Они применяются везде: в командах, в чате, в агенте.

Зачем: добавить контекст проекта ("мы работаем с УТ 11, используем стандарты ИТС"), задать тон, ограничить язык ответов, добавить правила кодирования вашей команды. Агент учитывает это в каждом ответе.

### Новая страница настроек «Промпты»

Всё собрано на отдельной странице в Preferences: шаблоны команд, system prompt, валидация плейсхолдеров, быстрый сброс к дефолтам.

---

## 2. Архитектурные промпты для 1С

Дефолтные шаблоны полностью переписаны. Раньше промпты были generic ("explain this code", "fix this code"). Теперь они ориентированы на BSL, SDBL, управляемые формы, EDT, транзакции, производительность и поддерживаемость.

### Что требуют новые шаблоны от модели

**Архитектурная декомпозиция:**
- выделение слоя (domain/app/infra/ui)
- описание границ ответственности
- контроль зависимостей и побочных эффектов

**Практики production-разработки в 1С:**
- минимально инвазивные изменения
- оценка регрессионных рисков
- явные допущения при неполном контексте
- сохранение поведения при фиксе

**Надежность и сопровождение:**
- классификация проблем по severity
- раздельно: быстрый patch и отложенные рефакторинги
- план проверки после изменений

**Оптимизация запросов SDBL:**
- кардинальность, индексы, стоимость операций
- риски изменения семантики
- план эквивалентности и профилирования

**Стандартизация и переиспользование:**
- анализ похожих реализаций
- сравнение архитектурных подходов
- рекомендации по унификации

### Пример: Fix Code — было и стало

**Раньше** агент получал: "Fix the following code, explain what was wrong."

Типичный ответ: исправленный код + краткое объяснение что поменялось.

**Теперь** агент получает структурированную инструкцию с ролью 1С-архитектора, требованием оценить severity, предложить минимально инвазивный patch, описать регрессионные риски и дать план проверки.

Типичный ответ:
- severity и классификация проблемы
- root cause с учётом контекста 1С (транзакции, блокировки, управляемые формы)
- patch с минимальными изменениями
- что может сломаться (регрессия)
- как проверить после применения

### Какие техники prompt engineering используются

**Role + Constraints** — модель получает роль архитектора 1С с фиксированными ограничениями, что снижает галлюцинации и лишнюю креативность.

**Structured Prompting** — инструкции и ожидаемый результат разделены по секциям, формат ответа задаётся явно.

**Output Contract** — для каждой задачи указан целевой формат (анализ, risks, patch, validation plan). Стабилизирует стиль и делает ответы пригодными для code review.

**Risk-aware Prompting** — встроено требование явно сообщать о рисках и компромиссах (trade-offs).

**Plan-before-code** — модель сначала формулирует допущения и границы, только затем генерирует код. Снижает вероятность архитектурно неверных правок.

**Task-specific Specialization** — отдельные промпты под разные режимы (генерация, фиксы, review, SDBL-оптимизация). Меньше универсальных размытых инструкций, больше контекстной точности.

---

## Практический эффект

- Ответы содержат оценку рисков, план проверки и разделение на быстрый patch и отложенный рефакторинг.
- Меньше рискованных изменений "в лоб" - агент учитывает регрессию и побочные эффекты.
- Генерация и фиксы ориентированы на реальный 1С-код: транзакции, блокировки, клиент-серверный контекст.
- Рекомендации по производительности SDBL с инженерным обоснованием, а не общими словами.
- Всё настраивается: не устраивает дефолт - правите шаблон под свой проект.
